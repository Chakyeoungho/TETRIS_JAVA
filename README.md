# 자바 프로그래밍 실습: 현대 테트리스 (Modern Tetris in Java)

**21114073 차경호 | 대구가톨릭대학교 컴퓨터소프트웨어학부**

> 본 프로젝트는 '자바프로그래밍실습' 기말 프로젝트로 진행되었으며, 고전 테트리스를 넘어 현대 테트리스 가이드라인의 핵심 기능들을 객체지향 설계 원칙에 따라 구현하는 것을 목표로 합니다.

## 📖 프로젝트 소개

이 프로젝트는 단순한 테트리스 클론이 아닌, 현대적인 플레이 경험을 제공하는 기능들을 포함하고 있습니다. **SRS(Super Rotation System)**, **T-Spin**, **7-Bag 시스템** 등 공식 가이드라인의 규칙들을 적용하여 전략적인 플레이가 가능하도록 설계되었습니다.

특히, 코드의 품질과 유지보수성을 높이기 위해 **단일 책임 원칙(SRP)**과 **의존성 역전 원칙(DIP)** 등 객체지향 설계 원칙을 적용하려 노력했습니다. 이를 통해 각 기능(블록 이동, 회전, 점수 계산 등)이 독립적인 클래스로 분리되어 관리됩니다.

## ✨ 주요 기능

### 기본 기능
- 테트로미노 좌/우 이동, 회전, 소프트 드롭, 하드 드롭
- 라인 클리어 및 점수 시스템
- 레벨에 따른 속도 증가
- 다음 블록 미리보기(1개)

### 현대 테트리스 가이드라인 (Modern Tetris Guideline) 기능
- **SRS (Super Rotation System)**: 벽이나 다른 블록에 막혔을 때, 5개의 오프셋 포인트를 테스트하여 회전을 가능하게 하는 '월킥(Wall Kick)' 시스템을 구현했습니다.
- **T-Spin & Mini T-Spin**: T-블록을 특정 조건으로 회전시켜 라인을 클리어하면 높은 보너스 점수를 획득하는 시스템입니다. (Single, Double, Triple 구현)
- **7-Bag System**: I, J, L, O, S, T, Z 7개의 테트로미노가 한 세트로 묶여 무작위 순서로 등장하여 블록 쏠림 현상을 방지합니다. 이를 바탕으로 총 6개의 블록 미리보기를 제공합니다.
- **Back-to-Back (B2B)**: T-Spin 또는 테트리스(4줄 클리어)를 연속으로 성공시키면 점수에 1.5배의 보너스가 적용됩니다.
- **Lock Delay**: 블록이 바닥에 닿은 후 즉시 고정되지 않고 0.5초의 유예 시간을 부여합니다. 이 시간 동안 블록을 움직이면 딜레이가 최대 15회까지 초기화됩니다.
- **Hold**: 현재 블록을 잠시 저장하고, 저장된 블록을 꺼내 사용하거나 교체할 수 있는 기능입니다. (턴당 1회)
- **Combo**: 연속으로 라인을 클리어하면 콤보 카운트가 오릅니다.

## ⚙️ 아키텍처 및 설계 철학

본 프로젝트는 **MVC(Model-View-Controller) 패턴**을 변형하여 시스템을 설계했으며, 향후 멀티플레이 확장을 고려하여 `PlayerManager`가 전체 게임 세트를 관리하는 구조를 채택했습니다.

### 컴포넌트 구조
- **Controller & Manager**:
  - `PlayerManager`: 게임 시스템 전체를 관리하며, 플레이어별 독립 환경을 제공하도록 설계되었습니다.
  - `TetrisEngine`: 게임의 모든 로직 흐름을 총괄하는 중앙 컨트롤러 역할을 합니다.
  - `InputHandler`: 사용자 입력을 받아 `TetrisEngine`에 전달합니다.
- **Model (Data Group)**:
  - `DataManager`: `PlayField`, `TetrominoState` 등 모든 상태 데이터를 소유하고 관리하는 Facade 역할을 수행합니다.
  - `PlayField`, `TetrominoState`, `TetrominoBag`: 순수한 데이터 객체(DTO)들입니다.
- **View (View Group)**:
  - `GameRenderer`: `DataManager`로부터 데이터를 읽어와 게임 상황을 화면에 시각화합니다.
- **Service (Logic Group)**:
  - `TetrominoMover`, `Spin`, `HoldHandler`, `CascadeHandler`, `ScoreManager` 등 각 클래스가 이동, 회전, 홀드, 라인 제거, 점수 계산과 같은 명확하고 독립적인 책임을 수행합니다. (단일 책임 원칙)
- **Timer Group**:
  - `GameTimer`, `LockDelayTimer`: `Thread.sleep()`의 비정밀성을 해결하기 위해 별도 스레드 기반의 **커스텀 타이머**를 구현했습니다. `wait/notify`와 `Thread.onSpinWait()`를 활용하여 마이크로초 단위의 정밀한 시간 제어와 높은 반응성을 확보했습니다.

## 🛠️ 주요 구현 내용 하이라이트

#### 1. 최적화된 라인 클리어 (`CascadeHandler`)
단순히 꽉 찬 줄을 한 줄씩 내리는 비효율적인 방식 대신, 한 번의 스캔으로 지워질 모든 라인의 수를 카운트한 후, 꽉 차지 않은 각 줄을 필요한 만큼 **한 번에 아래로** 내리는 방식으로 최적화했습니다.

#### 2. 정밀 커스텀 타이머
게임의 자동 하강(`GameTimer`)과 락 딜레이(`LockDelayTimer`)를 위해 별도의 스레드에서 동작하는 타이머를 구현했습니다. 이 타이머는 `Runnable`을 인자로 받아 실행할 작업을 유연하게 지정할 수 있으며, 두 타이머가 서로를 제어하며 게임 루프를 정밀하게 관리합니다.

#### 3. T-Spin 판정 로직
블록이 고정되는 시점에 `ScoreManager`는 아래 조건들을 순차적으로 검사하여 T-Spin 여부를 판정합니다.
1. 마지막 행동이 '회전'이었는가?
2. 현재 블록이 'T' 테트로미노인가?
3. SRS 월킥 테스트 중 5번째 오프셋으로 성공했는가? (`spinPoint == 5`)
4. T-블록의 주요 코너 4개 중 3개 이상이 다른 블록이나 벽으로 막혀있는가?

## 🖼️ 스크린샷

| T-Spin Triple 성공 직후                                  | Back-to-Back 보너스 적용                                    |
| --------------------------------------------------------- | ----------------------------------------------------------- |
|![Image](https://github.com/user-attachments/assets/628fe738-38cb-4c56-a9f1-f322903e684a)|![Image](https://github.com/user-attachments/assets/fbe190f4-043d-467a-8cdd-3f53d3275e94)|
|![Image](https://github.com/user-attachments/assets/df6a7949-9cd2-459c-b7c5-c18256174401)|![Image](https://github.com/user-attachments/assets/95099264-f731-4bf7-a234-c16307bc85af)|
| *T-Spin Triple 성공 시 1600점 획득 및 B2B 활성화*          | *연속 테트리스 성공 시 B2B 보너스(1.5배) 적용 (800점 → 1200점)* |


## 🚀 빌드 및 실행 방법

### 요구사항
- Java SE Development Kit (JDK) 11 이상

### IDE 사용 (권장)
1. Eclipse, IntelliJ 등 선호하는 Java IDE로 프로젝트를 가져옵니다.
2. `tetris.Tetris.java` 파일의 `main` 메소드를 실행합니다.

### 터미널 사용
1. 프로젝트의 최상위 디렉토리로 이동합니다.
2. 소스 코드를 컴파일합니다. (소스 파일이 `src` 폴더에 있다고 가정)
   ```bash
   javac -d bin -p src $(find src -name "*.java")
   ```
3. 컴파일된 클래스를 실행합니다.
   ```bash
   java -cp bin tetris.Tetris
   ```

## ⌨️ 조작키

| 키             | 기능                       |
| -------------- | -------------------------- |
| ← / →          | 블록 좌/우 이동            |
| ↓              | 소프트 드롭 (Soft Drop)    |
| Space          | 하드 드롭 (Hard Drop)      |
| ↑ / X          | 시계 방향 회전             |
| Z / Ctrl       | 반시계 방향 회전           |
| C / Shift      | 홀드 (Hold)                |
| F1 / ESC       | 일시정지 / 재개            |
| R              | 게임오버 시 재시작         |


## 📈 분석 및 향후 개선 방향

### 구현 성과
- SRS, T-Spin, 7-Bag, B2B 등 현대 테트리스의 핵심 기능들이 모두 의도대로 정상 동작함을 확인했습니다.

### 한계점 및 고찰
- **책임 분리의 한계**: `lockTetromino()` 메서드가 블록 고정 외에도 점수 계산, 줄 제거, 다음 블록 생성 등 너무 많은 책임을 지게 되어 단일 책임 원칙(SRP)을 일부 위반했습니다.
- **경직된 UI 구조**: UI 요소의 위치가 고정된 좌표값(매직 넘버)으로 하드코딩되어 창 크기 변경에 유연하게 대응하지 못합니다.
- **미구현된 가이드라인**: 키를 누르고 있을 때 자동으로 연속 이동하는 DAS(Delayed Auto Shift) 기능이 미구현 상태입니다.

### 향후 개선 방향
1.  **리팩토링**: `lockTetromino()`의 로직을 **옵저버 패턴(Observer Pattern)**을 도입하여 '블록 고정 이벤트' 발생 시 각 컴포넌트가 독립적으로 반응하도록 구조를 개선하겠습니다.
2.  **반응형 UI**: Swing의 `LayoutManager`를 적용하여 창 크기 변화에 유동적으로 대응하는 UI를 구현하겠습니다.
3.  **기능 추가**: DAS 기능과 플레이 시간 측정 등을 위해 타이머 시스템을 추상화하고 확장하겠습니다. 최종적으로는 온라인 멀티플레이 기능 구현을 시도해보고자 합니다.
